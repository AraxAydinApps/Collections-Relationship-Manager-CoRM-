<!doctype html>
<html lang="tr" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CoRM - Ödeme &amp; Erteleme</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&amp;family=Work+Sans:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    
    .font-heading {
      font-family: 'JetBrains Mono', monospace;
    }
    
    .font-body {
      font-family: 'Work Sans', sans-serif;
    }
    
    /* Main payment card */
    .payment-card {
      background-color: #18181b;
      border: 1px solid #27272a;
      border-radius: 8px;
      padding: 40px;
      max-width: 720px;
      margin: 0 auto;
    }
    
    /* Section dividers */
    .section-divider {
      height: 1px;
      background-color: #27272a;
      margin: 32px 0;
    }
    
    /* Company info */
    .info-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
    }
    
    .info-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: #71717a;
      font-weight: 600;
    }
    
    .info-value {
      font-size: 13px;
      color: #e4e4e7;
      font-weight: 600;
      font-family: 'JetBrains Mono', monospace;
    }
    
    /* Amount display */
    .amount-container {
      text-align: center;
      padding: 32px 0;
      background-color: #0f0f10;
      border-radius: 6px;
      border: 1px solid #27272a;
    }
    
    .amount-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #71717a;
      font-weight: 700;
      margin-bottom: 12px;
    }
    
    .amount-value {
      font-size: 48px;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
      color: #e4e4e7;
      line-height: 1;
      margin-bottom: 12px;
    }
    
    .amount-description {
      font-size: 11px;
      color: #a1a1aa;
      line-height: 1.5;
    }
    
    /* Status badge */
    .status-badge {
      display: inline-flex;
      align-items: center;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      margin-top: 12px;
    }
    
    .status-badge.due-today {
      background-color: rgba(234, 179, 8, 0.15);
      color: #fde047;
      border: 1px solid rgba(234, 179, 8, 0.3);
    }
    
    .status-badge.overdue {
      background-color: rgba(220, 38, 38, 0.15);
      color: #fca5a5;
      border: 1px solid rgba(220, 38, 38, 0.3);
    }
    
    /* Payment method cards */
    .payment-methods {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-top: 16px;
    }
    
    .payment-method-card {
      background-color: #0f0f10;
      border: 2px solid #27272a;
      border-radius: 6px;
      padding: 20px 16px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .payment-method-card:hover {
      border-color: #3f3f46;
      background-color: #18181b;
    }
    
    .payment-method-card.selected {
      border-color: #71717a;
      background-color: #18181b;
    }
    
    .payment-method-icon {
      font-size: 28px;
      margin-bottom: 12px;
    }
    
    .payment-method-title {
      font-size: 12px;
      font-weight: 700;
      color: #e4e4e7;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .payment-method-description {
      font-size: 10px;
      color: #71717a;
      line-height: 1.4;
    }
    
    /* Payment details area */
    .payment-details {
      background-color: #0f0f10;
      border: 1px solid #27272a;
      border-radius: 6px;
      padding: 24px;
      margin-top: 20px;
      display: none;
    }
    
    .payment-details.show {
      display: block;
    }
    
    .detail-group {
      margin-bottom: 16px;
    }
    
    .detail-group:last-child {
      margin-bottom: 0;
    }
    
    .detail-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: #71717a;
      font-weight: 700;
      margin-bottom: 8px;
    }
    
    .detail-value {
      font-size: 13px;
      color: #e4e4e7;
      font-weight: 600;
      font-family: 'JetBrains Mono', monospace;
      background-color: #18181b;
      border: 1px solid #27272a;
      border-radius: 4px;
      padding: 10px 14px;
    }
    
    .copy-button {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background-color: #27272a;
      border: 1px solid #3f3f46;
      color: #e4e4e7;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 8px;
    }
    
    .copy-button:hover {
      background-color: #3f3f46;
      border-color: #52525b;
    }
    
    /* Main action button */
    .btn-complete {
      width: 100%;
      background-color: #52525b;
      border: 1px solid #71717a;
      color: #e4e4e7;
      padding: 16px 32px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 32px;
    }
    
    .btn-complete:hover {
      background-color: #71717a;
      border-color: #a1a1aa;
    }
    
    .btn-complete:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .btn-subtitle {
      text-align: center;
      font-size: 10px;
      color: #71717a;
      margin-top: 12px;
      line-height: 1.5;
    }
    
    /* Info panel */
    .info-panel {
      background-color: #18181b;
      border: 1px solid #27272a;
      border-radius: 8px;
      padding: 32px;
      max-width: 720px;
      margin: 24px auto 0;
    }
    
    .info-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: #71717a;
      font-weight: 700;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid #27272a;
      font-family: 'JetBrains Mono', monospace;
    }
    
    .info-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .info-list li {
      padding: 10px 0 10px 24px;
      font-size: 12px;
      color: #d4d4d8;
      line-height: 1.6;
      position: relative;
    }
    
    .info-list li:before {
      content: '•';
      position: absolute;
      left: 8px;
      color: #71717a;
      font-weight: 700;
    }
    
    /* Security indicator */
    .security-badge {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 10px;
      color: #86efac;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.8px;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .payment-card {
        padding: 24px;
      }
      
      .payment-methods {
        grid-template-columns: 1fr;
      }
      
      .amount-value {
        font-size: 36px;
      }
    }
    
    /* Scrollbar */
    .custom-scroll::-webkit-scrollbar {
      width: 6px;
    }
    
    .custom-scroll::-webkit-scrollbar-track {
      background: #18181b;
    }
    
    .custom-scroll::-webkit-scrollbar-thumb {
      background: #3f3f46;
      border-radius: 3px;
    }
    
    .custom-scroll::-webkit-scrollbar-thumb:hover {
      background: #52525b;
    }
    
    /* Postpone Section */
    .postpone-section {
      background-color: #18181b;
      border: 1px solid #27272a;
      border-radius: 8px;
      padding: 32px;
      max-width: 720px;
      margin: 24px auto 0;
    }
    
    .postpone-header {
      text-align: center;
      margin-bottom: 24px;
      padding-bottom: 20px;
      border-bottom: 1px solid #27272a;
    }
    
    .postpone-title {
      font-size: 14px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #e4e4e7;
      margin-bottom: 8px;
      font-family: 'JetBrains Mono', monospace;
    }
    
    .postpone-subtitle {
      font-size: 11px;
      color: #a1a1aa;
      line-height: 1.5;
    }
    
    /* Rights indicator */
    .rights-box {
      background-color: #0f0f10;
      border: 1px solid #27272a;
      border-radius: 6px;
      padding: 20px;
      margin-bottom: 24px;
      text-align: center;
    }
    
    .rights-box.depleted {
      border-color: #dc2626;
      background-color: rgba(220, 38, 38, 0.1);
    }
    
    .rights-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: #71717a;
      font-weight: 700;
      margin-bottom: 12px;
    }
    
    .rights-display {
      font-size: 36px;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
      color: #e4e4e7;
      line-height: 1;
      margin-bottom: 8px;
    }
    
    .rights-display.depleted {
      color: #fca5a5;
    }
    
    .rights-description {
      font-size: 11px;
      color: #a1a1aa;
    }
    
    /* Form elements */
    .form-group {
      margin-bottom: 24px;
    }
    
    .form-label {
      display: block;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: #71717a;
      font-weight: 700;
      margin-bottom: 10px;
    }
    
    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      background-color: #0f0f10;
      border: 1px solid #27272a;
      color: #e4e4e7;
      padding: 12px 14px;
      border-radius: 4px;
      font-size: 12px;
      outline: none;
      transition: all 0.2s;
      font-family: 'Work Sans', sans-serif;
    }
    
    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      border-color: #52525b;
      background-color: #18181b;
    }
    
    .form-input:disabled,
    .form-select:disabled,
    .form-textarea:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .form-textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    .form-hint {
      font-size: 10px;
      color: #71717a;
      margin-top: 6px;
      font-style: italic;
    }
    
    /* Warning alerts */
    .alert-box {
      padding: 14px 16px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      line-height: 1.5;
      margin-bottom: 20px;
      border-left: 3px solid;
    }
    
    .alert-box.warning {
      background-color: rgba(234, 179, 8, 0.1);
      border-color: #eab308;
      color: #fde047;
    }
    
    .alert-box.danger {
      background-color: rgba(220, 38, 38, 0.1);
      border-color: #dc2626;
      color: #fca5a5;
    }
    
    .alert-box.info {
      background-color: rgba(59, 130, 246, 0.1);
      border-color: #3b82f6;
      color: #93c5fd;
    }
    
    /* Secondary button */
    .btn-secondary {
      width: 100%;
      background-color: #27272a;
      border: 1px solid #3f3f46;
      color: #e4e4e7;
      padding: 14px 32px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-secondary:hover:not(:disabled) {
      background-color: #3f3f46;
      border-color: #52525b;
    }
    
    .btn-secondary:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    
    /* Rules panel */
    .rules-panel {
      background-color: #18181b;
      border: 1px solid #27272a;
      border-radius: 8px;
      padding: 32px;
      max-width: 720px;
      margin: 24px auto 0;
    }
    
    .rules-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: #71717a;
      font-weight: 700;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid #27272a;
      font-family: 'JetBrains Mono', monospace;
    }
    
    .rules-list {
      list-style: none;
      padding: 0;
      margin: 0 0 20px 0;
    }
    
    .rules-list li {
      padding: 10px 0 10px 24px;
      font-size: 12px;
      color: #d4d4d8;
      line-height: 1.6;
      position: relative;
    }
    
    .rules-list li:before {
      content: '•';
      position: absolute;
      left: 8px;
      color: #71717a;
      font-weight: 700;
    }
    
    .rules-footer {
      padding: 16px;
      background-color: rgba(251, 191, 36, 0.1);
      border-left: 3px solid #fbbf24;
      border-radius: 4px;
      text-align: center;
      font-size: 12px;
      color: #fde047;
      font-weight: 600;
      font-style: italic;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full font-body">
  <div id="app-container" class="h-full w-full overflow-auto custom-scroll" style="background-color: #09090b;"><!-- Header -->
   <header class="border-b" style="background-color: #18181b; border-color: #27272a;">
    <div class="px-6 py-6 flex items-center justify-between"><!-- Left spacer -->
     <div class="w-32"></div><!-- Center Logo & Title -->
     <div class="flex flex-col items-center">
      <div class="flex items-center justify-center mb-3">
       <svg width="40" height="40" viewbox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="12" height="12" stroke="#71717a" stroke-width="1.5" fill="none" /> <rect x="18" y="2" width="12" height="12" stroke="#e4e4e7" stroke-width="1.5" fill="#e4e4e7" /> <rect x="2" y="18" width="12" height="12" stroke="#71717a" stroke-width="1.5" fill="none" /> <rect x="18" y="18" width="12" height="12" stroke="#71717a" stroke-width="1.5" fill="none" />
       </svg>
      </div>
      <div class="font-heading text-xl font-bold tracking-tight text-zinc-100 mb-1">
       CoRM
      </div>
      <div id="portal-name" class="text-xs text-zinc-500 tracking-wider">
       Tahsilat ve Ödeme Portalı
      </div>
     </div><!-- Right Info -->
     <div class="w-32 flex flex-col items-end gap-2">
      <div class="text-xs text-zinc-500 font-heading">
       03.02.2026
      </div>
      <div class="security-badge">
       <svg width="12" height="12" viewbox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 5H3C2.44772 5 2 5.44772 2 6V9C2 9.55228 2.44772 10 3 10H9C9.55228 10 10 9.55228 10 9V6C10 5.44772 9.55228 5 9 5Z" stroke="#86efac" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" /> <path d="M4 5V3.5C4 2.96957 4.21071 2.46086 4.58579 2.08579C4.96086 1.71071 5.46957 1.5 6 1.5C6.53043 1.5 7.03914 1.71071 7.41421 2.08579C7.78929 2.46086 8 2.96957 8 3.5V5" stroke="#86efac" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" />
       </svg> Güvenli Bağlantı
      </div>
     </div>
    </div>
   </header><!-- Main Content -->
   <main class="py-12 px-6"><!-- Payment Card -->
    <div class="payment-card"><!-- Company Info -->
     <div>
      <div class="text-center mb-6">
       <h1 id="page-title" class="font-heading text-2xl font-bold tracking-wide text-zinc-200 mb-2">ÖDEME &amp; ERTELEME</h1>
       <p id="page-subtitle" class="text-sm text-zinc-500">Ödeme yap veya sınırlı süreli erteleme talep et</p>
      </div>
      <div class="section-divider"></div>
      <div class="info-row">
       <div class="info-label">
        Firma/Kişi
       </div>
       <div id="company-name" class="info-value">
        Yıldız Makina Ltd. Şti.
       </div>
      </div>
      <div class="info-row">
       <div class="info-label">
        Hesap Kodu
       </div>
       <div id="account-code" class="info-value">
        120.01.001
       </div>
      </div>
      <div class="info-row">
       <div class="info-label">
        Dosya Numarası
       </div>
       <div id="file-number" class="info-value">
        DYM-2026-0142
       </div>
      </div>
      <div class="info-row">
       <div class="info-label">
        Sorumlu
       </div>
       <div id="responsible" class="info-value">
        Mehmet K.
       </div>
      </div>
     </div>
     <div class="section-divider"></div><!-- Amount Display -->
     <div class="amount-container">
      <div class="amount-label">
       Ödenecek Tutar
      </div>
      <div class="amount-value">
       ₺250.000,00
      </div>
      <div class="amount-description">
       Bu tutar sistemde kayıtlı son tahsilat sözüdür.
      </div>
      <div><span class="status-badge due-today">Bugün ödenmesi bekleniyor</span>
      </div>
     </div>
     <div class="section-divider"></div><!-- Payment Method Selection -->
     <div>
      <div class="info-label" style="margin-bottom: 16px;">
       Ödeme Yöntemi Seçin
      </div>
      <div class="payment-methods">
       <div class="payment-method-card" data-method="wire">
        <div class="payment-method-icon">
         <svg width="32" height="32" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin: 0 auto;"><path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="#e4e4e7" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" /> <path d="M9 22V12H15V22" stroke="#e4e4e7" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
         </svg>
        </div>
        <div class="payment-method-title">
         Havale / EFT
        </div>
        <div class="payment-method-description">
         Anında işlenir
        </div>
       </div>
       <div class="payment-method-card" data-method="card">
        <div class="payment-method-icon">
         <svg width="32" height="32" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin: 0 auto;"><rect x="2" y="5" width="20" height="14" rx="2" stroke="#e4e4e7" stroke-width="1.5" /> <path d="M2 10H22" stroke="#e4e4e7" stroke-width="1.5" stroke-linecap="round" /> <path d="M6 15H10" stroke="#e4e4e7" stroke-width="1.5" stroke-linecap="round" />
         </svg>
        </div>
        <div class="payment-method-title">
         Kredi Kartı
        </div>
        <div class="payment-method-description">
         Güvenli ödeme
        </div>
       </div>
       <div class="payment-method-card" data-method="online">
        <div class="payment-method-icon">
         <svg width="32" height="32" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin: 0 auto;"><circle cx="12" cy="12" r="9" stroke="#e4e4e7" stroke-width="1.5" /> <path d="M12 16V12L15 9" stroke="#e4e4e7" stroke-width="1.5" stroke-linecap="round" />
         </svg>
        </div>
        <div class="payment-method-title">
         Online Ödeme
        </div>
        <div class="payment-method-description">
         Hızlı ve kolay
        </div>
       </div>
      </div>
     </div><!-- Payment Details (Dynamic) -->
     <div class="payment-details" id="details-wire">
      <div class="detail-group">
       <div class="detail-label">
        Banka Adı
       </div>
       <div class="detail-value">
        Türkiye İş Bankası A.Ş.
       </div>
      </div>
      <div class="detail-group">
       <div class="detail-label">
        IBAN
       </div>
       <div class="detail-value">
        TR33 0006 4000 0011 2345 6789 01
       </div><button class="copy-button" onclick="copyToClipboard('TR33 0006 4000 0011 2345 6789 01')">
        <svg width="12" height="12" viewbox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 1H3C2.44772 1 2 1.44772 2 2V7" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" /> <rect x="4" y="4" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.2" />
        </svg> Kopyala </button>
      </div>
      <div class="detail-group">
       <div class="detail-label">
        Alıcı Ünvan
       </div>
       <div class="detail-value">
        ABC Tahsilat Hizmetleri A.Ş.
       </div>
      </div>
      <div class="detail-group">
       <div class="detail-label">
        Açıklama (Zorunlu)
       </div>
       <div class="detail-value">
        120.01.001 – DYM-2026-0142
       </div><button class="copy-button" onclick="copyToClipboard('120.01.001 – DYM-2026-0142')">
        <svg width="12" height="12" viewbox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 1H3C2.44772 1 2 1.44772 2 2V7" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" /> <rect x="4" y="4" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.2" />
        </svg> Kopyala </button>
      </div>
     </div>
     <div class="payment-details" id="details-card">
      <div class="detail-group">
       <div class="detail-label">
        Bilgi
       </div>
       <div style="padding: 16px; background: rgba(234, 179, 8, 0.1); border-radius: 4px; border-left: 3px solid #fde047;">
        <p style="font-size: 11px; color: #fde047; line-height: 1.5;">Güvenli ödeme bağlantısı size özel olarak gönderilmiştir. Ödeme sonrası tutar, otomatik olarak borç bakiyesinden düşülecektir.</p>
       </div>
      </div>
     </div>
     <div class="payment-details" id="details-online">
      <div class="detail-group">
       <div class="detail-label">
        Online Ödeme Sayfası
       </div>
       <div style="padding: 16px; background: rgba(134, 239, 172, 0.1); border-radius: 4px; border-left: 3px solid #86efac; text-align: center;">
        <p style="font-size: 11px; color: #86efac; margin-bottom: 12px; line-height: 1.5;">Güvenli ödeme sayfasına yönlendirileceksiniz.</p><button style="background: #52525b; border: 1px solid #71717a; color: #e4e4e7; padding: 10px 20px; border-radius: 4px; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#71717a'" onmouseout="this.style.background='#52525b'" onclick="handleOnlinePayment()"> Ödemeye Git → </button>
       </div>
      </div>
     </div><!-- Complete Button --> <button class="btn-complete" id="btn-complete" disabled onclick="completePayment()"> ÖDEMEYİ TAMAMLA </button>
     <div class="btn-subtitle">
      Ödeme alındığında dosya otomatik güncellenir.<br>
       Dekont göndermenize gerek yoktur.
     </div>
    </div><!-- Info Panel -->
    <div class="info-panel">
     <div class="info-title">
      Bilgilendirme
     </div>
     <ul class="info-list">
      <li>Bu ödeme CoRM sistemi üzerinden kayıt altına alınır.</li>
      <li>Ödeme sonrası sorumlu ekip bilgilendirilir.</li>
      <li>Ödeme alınmadan dosya kapanmaz.</li>
      <li>Soruların  z için sorumlu kişiyle iletişime geçebilirsiniz.</li>
     </ul>
    </div><!-- Postpone Section -->
    <div class="postpone-section">
     <div class="postpone-header">
      <div class="postpone-title">
       Erteleme Talebi (Sınırlı)
      </div>
      <div class="postpone-subtitle">
       Erteleme yalnızca sistemin izin verdiği sayıda ve sürede mümkündür.
      </div>
     </div><!-- Remaining Rights -->
     <div class="rights-box" id="rights-box">
      <div class="rights-label">
       Kalan Erteleme Hakkı
      </div>
      <div class="rights-display" id="rights-display">
       1 / 3
      </div>
      <div class="rights-description">
       Bu dosyada toplam 3 kez erteleme yapılabilir.
      </div>
     </div><!-- Date Selection -->
     <div class="form-group"><label class="form-label" for="postpone-date">Yeni Ödeme Tarihi</label> <input type="date" id="postpone-date" class="form-input">
      <div class="form-hint">
       Seçilebilecek tarih: Bugünden itibaren en fazla 7 gün
      </div>
     </div><!-- Reason Selection -->
     <div class="form-group"><label class="form-label" for="postpone-reason">Erteleme Nedeni</label> <select id="postpone-reason" class="form-select"> <option value="">Neden seçin</option> <option value="cashflow">Nakit akışı gecikmesi</option> <option value="bank">Banka işlemi bekleniyor</option> <option value="accounting">Muhasebe onayı bekleniyor</option> <option value="technical">Teknik / operasyonel neden</option> <option value="other">Diğer</option> </select>
     </div><!-- Optional Description -->
     <div class="form-group"><label class="form-label" for="postpone-description">Açıklama (Opsiyonel)</label> <textarea id="postpone-description" class="form-textarea" placeholder="Örn: Banka transferi yarın gerçekleşecek"></textarea>
     </div><!-- Dynamic Warnings -->
     <div id="postpone-warnings"></div><!-- Submit Button --> <button class="btn-secondary" id="btn-postpone" disabled onclick="submitPostponeRequest()"> ERTELEME TALEBİ GÖNDER </button>
     <div class="btn-subtitle">
      Bu talep sisteme kaydedilir ve sorumlu ekip bilgilendirilir.
     </div>
    </div><!-- Rules Panel -->
    <div class="rules-panel">
     <div class="rules-title">
      Erteleme Kuralları
     </div>
     <ul class="rules-list">
      <li>Her dosya için erteleme sayısı sınırlıdır.</li>
      <li>Her erteleme en fazla 7 gün olabilir.</li>
      <li>Erteleme hakkı dolduğunda ödeme zorunludur.</li>
      <li>Kurallara uyulmaması dosyanın X sürecine alınmasına neden olur.</li>
     </ul>
     <div class="rules-footer">
      Bu kurallar herkes için aynıdır.
     </div>
    </div>
   </main>
  </div>
  <script>
  /***********************
   * CoRM Payment Portal (Dynamic)
   * Reads: token + case_id from URL
   * Calls: getPayContext, setDebtorDate, debtorPaymentNotice
   ***********************/

  const WEBAPP_URL = "/api/corm";

  const qs = (k) => new URL(location.href).searchParams.get(k) || "";
  const token = qs("token");
  const caseId = qs("case_id");

  const $ = (id) => document.getElementById(id);

  function fmtTRY(n){
    const x = Number(n);
    const v = Number.isFinite(x) ? x : 0;
    return v.toLocaleString("tr-TR", { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " ₺";
  }
  function isoToTr(iso){
    if (!iso) return "-";
    // yyyy-mm-dd => dd.mm.yyyy
    if (/^\d{4}-\d{2}-\d{2}$/.test(iso)) return iso.slice(8,10)+"."+iso.slice(5,7)+"."+iso.slice(0,4);
    return iso;
  }
  function toast(msg, ok=true){
    const message = document.createElement('div');
    message.style.cssText =
      'position: fixed; top: 20px; right: 20px; background: ' + (ok ? 'rgba(134,239,172,0.2)' : 'rgba(252,165,165,0.15)') +
      '; border: 1px solid ' + (ok ? '#86efac' : '#fca5a5') +
      '; color: ' + (ok ? '#86efac' : '#fca5a5') +
      '; padding: 12px 20px; border-radius: 6px; font-size: 11px; font-weight: 600; z-index: 1000;';
    message.textContent = msg;
    document.body.appendChild(message);
    setTimeout(() => message.remove(), 2500);
  }

  async function apiPost(payload){
    const res = await fetch(WEBAPP_URL, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(payload),
    });
    if (!res.ok) throw new Error("HTTP " + res.status);
    return await res.json();
  }

  // Payment method selection
  let selectedMethod = null;
  document.querySelectorAll('.payment-method-card').forEach(card => {
    card.addEventListener('click', function() {
      document.querySelectorAll('.payment-method-card').forEach(c => c.classList.remove('selected'));
      this.classList.add('selected');

      document.querySelectorAll('.payment-details').forEach(panel => panel.classList.remove('show'));
      const method = this.getAttribute('data-method');
      selectedMethod = method;
      const detailPanel = document.getElementById('details-' + method);
      if (detailPanel) detailPanel.classList.add('show');

      $("btn-complete").disabled = false;
    });
  });

  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => toast('✓ Kopyalandı', true)).catch(() => toast('Kopyalama başarısız', false));
  }
  window.copyToClipboard = copyToClipboard;

  function handleOnlinePayment(){
    toast("Güvenli ödeme sayfasına yönlendiriliyorsunuz...", true);
  }
  window.handleOnlinePayment = handleOnlinePayment;

  let ctx = null; // {case, portal}

  function setStatusBadge(caseObj){
    // Basic badge rule: today due => due-today, overdue => overdue
    const badge = document.querySelector(".status-badge");
    if (!badge) return;

    const today = new Date(); today.setHours(0,0,0,0);
    const dueIso = (caseObj.due_date || "").slice(0,10);
    let dueDate = null;
    if (/^\d{4}-\d{2}-\d{2}$/.test(dueIso)) {
      dueDate = new Date(dueIso + "T00:00:00");
    }

    badge.classList.remove("due-today","overdue");
    if (dueDate && dueDate.getTime() === today.getTime()){
      badge.classList.add("due-today");
      badge.textContent = "Bugün ödenmesi bekleniyor";
    } else if (dueDate && dueDate.getTime() < today.getTime()){
      badge.classList.add("overdue");
      badge.textContent = "Vade geçti";
    } else {
      badge.classList.add("due-today");
      badge.textContent = "Ödeme bekleniyor";
    }
  }

  function applyPayInfo(payInfo, caseObj){
    // Wire panel fill (if you set Script Properties)
    const bankName = payInfo.bank_name || "—";
    const iban = payInfo.iban || "—";
    const receiver = payInfo.receiver || "—";

    // Replace hardcoded values inside wire panel
    const wire = $("details-wire");
    if (wire) {
      const nodes = wire.querySelectorAll(".detail-value");
      // expected order: Banka Adı, IBAN, Alıcı Ünvan, Açıklama
      if (nodes[0]) nodes[0].textContent = bankName;
      if (nodes[1]) nodes[1].textContent = iban;
      if (nodes[2]) nodes[2].textContent = receiver;

      const desc = `${caseObj.account_code || ""} – ${caseObj.case_id || ""}`.trim();
      if (nodes[3]) nodes[3].textContent = desc || "—";

      // Update copy buttons handlers to dynamic values
      const btns = wire.querySelectorAll(".copy-button");
      if (btns[0]) btns[0].onclick = () => copyToClipboard(iban);
      if (btns[1]) btns[1].onclick = () => copyToClipboard(desc);
    }
  }

  function initPostponeUI(){
    const caseObj = ctx.case;
    const p = ctx.portal;

    const remain = Math.max(0, Number(p.postpone_limit) - Number(p.postpone_used));
    const max = Number(p.postpone_limit);

    const rightsBox = $("rights-box");
    const rightsDisplay = $("rights-display");
    if (rightsDisplay) rightsDisplay.textContent = `${remain} / ${max}`;

    // max days rule
    const maxDays = Number(p.max_postpone_days) || 7;
    const dateInput = $("postpone-date");

    const today = new Date();
    const maxDate = new Date();
    maxDate.setDate(today.getDate() + maxDays);

    dateInput.min = today.toISOString().split('T')[0];
    dateInput.max = maxDate.toISOString().split('T')[0];

    // If no rights -> disable
    const reasonSel = $("postpone-reason");
    const desc = $("postpone-description");
    const btn = $("btn-postpone");

    if (remain <= 0){
      rightsBox.classList.add("depleted");
      rightsDisplay.classList.add("depleted");
      rightsDisplay.textContent = "Erteleme Hakkı Doldu";
      dateInput.disabled = true;
      reasonSel.disabled = true;
      desc.disabled = true;
      btn.disabled = true;
      $("postpone-warnings").innerHTML = '<div class="alert-box danger">Erteleme hakkınız kalmamıştır. Ödeme yapmanız gerekmektedir.</div>';
      return;
    }

    // validate on change
    function validate(){
      const date = dateInput.value;
      const reason = reasonSel.value;
      btn.disabled = !(date && reason);
    }

    dateInput.addEventListener("change", validate);
    reasonSel.addEventListener("change", validate);

    // expose submit handler
    window.submitPostponeRequest = async function(){
      const date = dateInput.value;
      const reason = reasonSel.value;
      const note = desc.value;

      if (!date || !reason) return;

      btn.disabled = true;
      const oldText = btn.textContent;
      btn.textContent = "GÖNDERILIYOR...";

      try {
        const r = await apiPost({
          action: "setDebtorDate",
          case_id: caseId,
          token,
          debtor_date: date,
          reason,
          note
        });
        if (!r.ok) throw new Error(r.error || "setDebtorDate failed");

        toast("✓ Erteleme kaydedildi", true);

        // refresh context
        await loadContext();

        // reset inputs
        dateInput.value = "";
        reasonSel.value = "";
        desc.value = "";
      } catch(e){
        toast("Hata: " + (e.message || e), false);
      } finally {
        btn.textContent = oldText;
        // re-evaluate enabled state
        btn.disabled = true;
      }
    };
  }

  window.completePayment = async function(){
    if (!selectedMethod) return;

    const btn = $("btn-complete");
    btn.disabled = true;
    const oldText = btn.textContent;
    btn.textContent = "İŞLENİYOR...";

    try {
      const r = await apiPost({
        action: "debtorPaymentNotice",
        case_id: caseId,
        token,
        method: selectedMethod,
        note: ""
      });
      if (!r.ok) throw new Error(r.error || "debtorPaymentNotice failed");

      toast("✓ Bildiriminiz alındı (ekip kontrol edecek)", true);

      // UX: show modal message (existing style)
      const message = document.createElement('div');
      message.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #18181b; border: 1px solid #27272a; padding: 32px; border-radius: 8px; text-align: center; z-index: 1000; max-width: 400px;';
      message.innerHTML = `
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin: 0 auto 16px;">
          <circle cx="24" cy="24" r="22" stroke="#86efac" stroke-width="2"/>
          <path d="M14 24L20 30L34 16" stroke="#86efac" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div style="font-size: 16px; font-weight: 700; color: #e4e4e7; margin-bottom: 8px;">Bildirim Alındı</div>
        <div style="font-size: 12px; color: #a1a1aa; line-height: 1.5;">
          Ödeme bildiriminiz kaydedildi. Ekibimiz kontrol ettikten sonra dosya güncellenecektir.
        </div>
      `;
      document.body.appendChild(message);
      setTimeout(()=>message.remove(), 3000);

    } catch(e){
      toast("Hata: " + (e.message || e), false);
    } finally {
      btn.textContent = oldText;
      btn.disabled = false;
    }
  };

  async function loadContext(){
    if (!token || !caseId){
      toast("Geçersiz bağlantı (token/case_id yok)", false);
      return;
    }
    const data = await apiPost({ action:"getPayContext", case_id: caseId, token });
    if (!data.ok) throw new Error(data.error || "getPayContext failed");
    ctx = data;

    const c = ctx.case;
    const p = ctx.portal;

    // Fill header / basic
    $("company-name").textContent = c.account_name || "-";
    $("account-code").textContent = c.account_code || "-";
    $("file-number").textContent = c.case_id || "-";
    $("responsible").textContent = p.owner_full_name || String(c.owner_user_id || "-");

    // Amount section
    const amountEl = document.querySelector(".amount-value");
    if (amountEl) amountEl.textContent = fmtTRY(p.amount_due);

    // Description text
    const desc = document.querySelector(".amount-description");
    if (desc){
      if (Number(c.promise_amount) > 0) desc.textContent = "Bu tutar sistemde kayıtlı son tahsilat sözüdür.";
      else desc.textContent = "Bu tutar geciken/aktif bakiye üzerinden hesaplanmıştır.";
    }

    setStatusBadge(c);
    applyPayInfo(p.pay_info || {}, c);

    // Postpone rules text dynamic
    const hint = document.querySelector(".form-hint");
    if (hint) hint.textContent = `Seçilebilecek tarih: Bugünden itibaren en fazla ${p.max_postpone_days} gün`;

    // Init postpone section
    initPostponeUI();
  }

  // On load
  (async function init(){
    try {
      await loadContext();
    } catch(e){
      toast("Hata: " + (e.message || e), false);
    }
  })();
</script>

 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c830edcb6762459',t:'MTc3MDEzMzU1NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
